/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.2
 * 
 * Modified by Milano
 *
 */

!function(a){a.fn.extend({slimScroll:function(b){var c={width:"auto",height:"250px",size:"7px",railSize:"10px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,railColor:"#000",railOpacity:.15,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200},d=a.extend(c,b);return this.each(function(){function B(b){if(c){var b=b||window.event,e=0;b.wheelDelta&&(e=-b.wheelDelta/120),b.detail&&(e=b.detail/3);var f=b.target||b.srcTarget||b.srcElement;a(f).closest("."+d.wrapperClass).is(u.parent())&&C(e,!0),b.preventDefault&&!n&&b.preventDefault(),n||(b.returnValue=!1)}}function C(a,b,c){n=!1;var e=a,f=u.outerHeight()-z.outerHeight();if(b&&(e=parseInt(z.css("top"))+a*parseInt(d.wheelStep)/100*z.outerHeight(),e=Math.min(Math.max(e,0),f),e=a>0?Math.ceil(e):Math.floor(e),z.css({top:e+"px"})),j=parseInt(z.css("top"))/(u.outerHeight()-z.outerHeight()),e=j*(u[0].scrollHeight-u.outerHeight()),c){e=a;var g=e/u[0].scrollHeight*u.outerHeight();g=Math.min(Math.max(g,0),f),z.css({top:g+"px"})}u.scrollTop(e),u.trigger("slimscrolling",~~e),F(),G()}function D(){window.addEventListener?(this.addEventListener("DOMMouseScroll",B,!1),this.addEventListener("mousewheel",B,!1)):document.attachEvent("onmousewheel",B)}function E(){i=Math.max(u.outerHeight()/u[0].scrollHeight*u.outerHeight(),m),z.css({height:i+"px"});var a=i==u.outerHeight()?0:1;z.css({opacity:a})}function F(){if(E(),clearTimeout(g),j==~~j){if(n=d.allowPageScroll,k!=j){var a=0==~~j?"top":"bottom";u.trigger("slimscroll",a)}}else n=!1;return k=j,i>=u.outerHeight()?void(n=!0):void y.stop(!0,!0).animate({visibility:"visible",opacity:1},"slow")}function G(){d.alwaysVisible||(g=setTimeout(function(){d.disableFadeOut&&c||e||f||y.animate({visibility:"hidden",opacity:0},"slow").removeClass("slimScrollHover")},1e3))}function H(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("style");c.setAttribute("type","text/css"),c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a)),b.appendChild(c)}function I(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null}function J(a,b){var c=I(a);return c?"rgba("+c.r+", "+c.g+", "+c.b+", "+b+")":a.replace("rgb","rgba").replace(")",", "+b+")")}function K(a,b,c){var d=a.offset().left-b,e=a.offset().top-b,f=d+a.width()+2*b,g=e+a.height()+2*b,h=c.pageX,i=c.pageY;return h>d&&f>h&&i>e&&g>i}var c,e,f,g,h,i,j,k,l="<div></div>",m=30,n=!1,o="."+d.barClass,p=o+":hover",q="."+d.railClass,r=q+":hover",s="railClassOver",u=a(this);if(u.parent().hasClass(d.wrapperClass)){var v=u.scrollTop();if(z=u.parent().find(o),y=u.parent().find(q),E(),a.isPlainObject(b)){if("height"in b&&"auto"==b.height){u.parent().css("height","auto"),u.css("height","auto");var w=u.parent().parent().height();u.parent().css("height",w),u.css("height",w)}if("scrollTo"in b)v=parseInt(d.scrollTo);else if("scrollBy"in b)v+=parseInt(d.scrollBy);else if("destroy"in b)return z.remove(),y.remove(),void u.unwrap();C(v,!1,!0)}}else{d.height="auto"==b.height?u.parent().height():b.height;var x=a(l).addClass(d.wrapperClass).css({position:"relative",overflow:"hidden",width:d.width,height:d.height});u.css({overflow:"hidden",width:d.width,height:d.height}),H(q+", "+o+" {position: absolute; top: 0;cursor: pointer;transition: width 250ms;-webkit-transition: width 250ms;-moz-transition: width 250ms;-o-transition: width 250ms;}"),H(p+", "+r+" "+o+" {width: "+d.railSize+";opacity: 1}"),H(q+" {width: "+d.railSize+";height: 100%;z-index: 90;}"),H(o+" {width: "+d.size+";z-index: 99;}"),H("."+s+" {opacity: 1;background: "+J(d.railColor,d.railOpacity)+"}");var y=a(l).addClass(d.railClass).css({"border-radius":d.railSize,BorderRadius:d.railSize,MozBorderRadius:d.railSize,WebkitBorderRadius:d.railSize}),z=a(l).addClass(d.barClass).css({background:J(d.color,d.opacity),"border-radius":d.size,BorderRadius:d.size,MozBorderRadius:d.size,WebkitBorderRadius:d.size}),A="right"==d.position?{right:d.distance}:{left:d.distance};y.css(A),z.css("right"==d.position?{right:0}:{left:0}),u.wrap(x),u.parent().append(y),y.append(z),G(),d.railDraggable&&(z.bind("mousedown",function(b){var c=a(document);return f=!0,t=parseFloat(z.css("top")),pageY=b.pageY,c.bind("mousemove.slimscroll",function(a){currTop=t+a.pageY-pageY,z.css("top",currTop),C(0,z.position().top,!1)}),c.bind("mouseup.slimscroll",function(){f=!1,G(),c.unbind(".slimscroll")}),!1}).bind("selectstart.slimscroll",function(a){return a.stopPropagation(),a.preventDefault(),!1}),y.bind("click",function(a){if(!z.is(":hover")){var b=a.pageY,c=parseFloat(z.css("top"));currTop=c>b?c-z.height():c+z.height(),z.animate({top:currTop},"fast",function(){C(0,z.position().top,!1)})}})),y.hover(function(){e=!0,F(),y.stop(!0,!0).addClass(s)},function(){e=!1,G(),y.stop(!0,!0).removeClass(s)}),z.hover(function(){e=!0},function(){e=!1}),u.hover(function(){c=!0,F(),G()},function(){c=!1,G()}).on("mousemove",function(a){K(y,20,a)?(e=!0,F()):(e=!1,G())}),u.bind("touchstart",function(a){a.originalEvent.touches.length&&(h=a.originalEvent.touches[0].pageY)}),u.bind("touchmove",function(a){if(n||a.originalEvent.preventDefault(),a.originalEvent.touches.length){var b=(h-a.originalEvent.touches[0].pageY)/d.touchScrollStep;C(b,!0),h=a.originalEvent.touches[0].pageY}}),E(),"bottom"===d.start?(z.css({top:u.outerHeight()-z.outerHeight()}),C(0,!0)):"top"!==d.start&&(C(a(d.start).position().top,null,!0),d.alwaysVisible||z.hide()),D()}}),this}}),a.fn.extend({slimscroll:a.fn.slimScroll})}(jQuery);